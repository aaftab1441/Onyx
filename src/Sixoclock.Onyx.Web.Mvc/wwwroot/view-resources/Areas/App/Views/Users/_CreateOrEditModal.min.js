(function(n){app.modals.CreateOrEditUserModal=function(){function f(){var i=[];return t.getModal().find(".user-role-checkbox-list input[type=checkbox]").each(function(){n(this).is(":checked")&&i.push(n(this).attr("name"))}),i}function c(){var n={};return s.serializeArray().map(function(t){n[abp.utils.toCamelCase(t.name)]=t.value}),n}var r=abp.services.app.user,t,i=null,e=new app.PasswordComplexityHelper,u,o=n("#TransactionsTable"),s=n("#TransactionsFilterForm"),h;n("#datetimepicker").datepicker({format:"mm/dd/yyyy"});this.init=function(r){t=r;u=new OrganizationTree;u.init(t.getModal().find(".organization-tree"));i=t.getModal().find("form[name=UserInformationsForm]");i.validate();_$tagsForm=t.getModal().find("form[name=TagsForm]");_$billingForm=t.getModal().find("form[name=BillingForm]");var o=t.getModal().find("input[name=Password],input[name=PasswordRepeat]"),s=o.closest(".form-group");e.setPasswordComplexityRules(o,window.passwordComplexitySetting);n("#EditUser_SetRandomPassword").change(function(){n(this).is(":checked")?(s.slideUp("fast"),t.getArgs().id||o.removeAttr("required")):(s.slideDown("fast"),t.getArgs().id||o.attr("required","required"))});t.getModal().find(".user-role-checkbox-list input[type=checkbox]").change(function(){n("#assigned-role-count").text(f().length)});t.getModal().find("[data-toggle=tooltip]").tooltip()};r.getTransactionsTotal({id:n("#Id").val()}).done(function(t){var i=new Date;t.length==0?n("#container").highcharts({chart:{zoomType:"xy"},credits:{enabled:!1},title:{text:"Transaction Totals"},xAxis:[{categories:[i.getDate(),i.addDays(1).getDate(),i.addDays(2).getDate(),i.addDays(3).getDate(),i.addDays(4).getDate(),i.addDays(5).getDate(),i.addDays(6).getDate()],crosshair:!0}],yAxis:[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"Delivered Kwh",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"Count",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0},legend:{layout:"vertical",align:"left",x:120,verticalAlign:"top",y:100,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},series:[{name:"Count",type:"column",yAxis:1,data:[0,0,0,0,0,0,0]},{name:"Delivered Kwh",type:"column",data:[0,0,0,0,0,0,0]}]}):n("#container").highcharts({chart:{zoomType:"xy"},credits:{enabled:!1},title:{text:"Transaction Totals"},xAxis:[{categories:t.map(n=>n.date),crosshair:!0}],yAxis:[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"Delivered Kwh",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"Count",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0},legend:{layout:"vertical",align:"left",x:120,verticalAlign:"top",y:100,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},series:[{name:"Count",type:"column",yAxis:1,data:t.map(n=>parseInt(n.transactionsCount))},{name:"Delivered Kwh",type:"column",data:t.map(n=>parseInt(n.kwhDelivered))}]})});n('a[data-toggle="tab"]').on("shown.bs.tab",function(){n(window).trigger("resize")});Date.prototype.addDays=function(n){var t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t};this.save=function(){if(i.valid()){var e=f(),n=i.serializeFormToObject(),o=_$tagsForm.serializeFormToObject(),s=_$billingForm.serializeFormToObject();n.SetRandomPassword&&(n.Password=null);t.setBusy(!0);r.createOrUpdateUser({user:n,tag:o,billing:s,assignedRoleNames:e,sendActivationEmail:n.SendActivationEmail,SetRandomPassword:n.SetRandomPassword,organizationUnits:u.getSelectedOrganizations()}).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));t.close();abp.event.trigger("app.createOrEditUserModalSaved")}).always(function(){t.setBusy(!1)})}};h=o.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getTransactions,inputFilter:function(){return c()}},columnDefs:[{data:null,orderable:!1,autoWidth:!1,defaultContent:""},{targets:0,data:"date",render:function(n){return moment(n).format("L")}},{targets:1,data:"duration",render:function(n){return moment(n).format("L")}},{targets:2,data:"kwh"},{targets:3,data:"installation"},{targets:4,data:"group"},{targets:5,data:"charger"},{targets:6,data:"evse"},{targets:7,data:"user"},{targets:8,data:"billKwh"},{targets:9,data:"billMin"},{targets:10,data:"cost"},{targets:11,data:"toBilled"},{targets:12,data:"earned"}]})}})(jQuery);