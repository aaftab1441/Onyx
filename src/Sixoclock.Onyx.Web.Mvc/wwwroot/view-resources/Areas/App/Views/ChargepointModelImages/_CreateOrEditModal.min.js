(function(){app.modals.CreateOrEditChargepointModelImageModal=function(){var r=null,n=null,t,u=abp.services.app.chargepointModelImage,i=null;this.init=function(u){t=u;$("#ChargepointModalImageForm input[name=ChargepointModelImage]").change(function(){$("#ChargepointModalImageForm").submit()});$("#ChargepointModalImageForm").ajaxForm({beforeSubmit:function(){var r=$("#ChargepointModalImageForm input[name=ChargepointModelImage]"),t=r.get()[0].files,n,i;return t.length?(n=t[0],i="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|","|jpg|jpeg|png|gif|".indexOf(i)===-1)?(abp.message.warn(app.localize("ChargepointModelImage_Change_Error")),!1):!0:!1},success:function(t){if(t.success){var i=$("#ChargepointModelImageResize"),u=abp.appPath+"Images/Tenants/"+t.result.fileName+"?v="+(new Date).valueOf();r=t.result.fileName;n&&n.destroy();i.show();i.attr("src",u);i.attr("originalWidth",t.result.width);i.attr("originalHeight",t.result.height);i.Jcrop({setSelect:[0,0,100,100],aspectRatio:1,boxWidth:400,boxHeight:400},function(){n=this})}else abp.message.error(t.error.message)}});$("#ChargepointModelImageResize").hide();i=t.getModal().find("form");i.validate()};this.save=function(){var f;if(i.valid()&&r){f={};n&&(f=n.getSelection());var o=n.getContainerSize()[0],s=n.getContainerSize()[1],h=o,c=s;$("#ChargepointModelImageResize")&&(h=parseInt($("#ChargepointModelImageResize").attr("originalWidth")),c=parseInt($("#ChargepointModelImageResize").attr("originalHeight")));var l=h/o,a=c/s,e=i.serializeFormToObject();e.originalFileName=r;e.x=parseInt(f.x*l);e.y=parseInt(f.y*a);e.width=parseInt(f.w*l);e.height=parseInt(f.h*a);t.setBusy(!0);u.createOrUpdateChargepointModelImage(e).done(function(){t.close();location.reload()}).always(function(){t.setBusy(!1)})}}}})();